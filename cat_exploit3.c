#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <errno.h>
#include <unistd.h>
#include <stdlib.h>

#define BUFFER_SIZE 10000
char buffer[BUFFER_SIZE];
extern char ** environ;

int main(int argc, char *argv[]) {
    
    char path[BUFFER_SIZE];
    char *envvar = "LD_PRELOAD";

    char * test = getenv(envvar);
    if(test) {
        printf("you are in a sandbox. Cutting it off...\n");
        fflush(stdout);
        unsetenv(envvar);
        execve(argv[0], argv, environ);
        exit(1);
    }

    for(int idx = 1; idx < argc; idx++) {
        // int open(const char *pathname, int flags);
        int file = open(argv[idx], O_RDONLY);
        if (file == -1) {
            perror("open");
            continue;
        }
        
        ssize_t r = 0;
        while((r = read(file, buffer, BUFFER_SIZE-1)) > 0) {
            printf("%s", buffer);
            fflush(stdout);
        }
        if (r < 0) {
            perror("read");
        }

        if(close(file) == -1) {
            perror("close");
            continue;
        }
    }

    return 0;

}